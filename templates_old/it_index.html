<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Assets</title>
    <style>








body {
    font-family: 'Roboto', sans-serif;
    background-color: #f8f9fa;
    margin: 0;
    padding: 0;
}

/* Header Section */
.header {
    background-color: #2f276f;
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
}

.header h1 {
    margin: 0;
    font-size: 28px;
	color:white;
}

.header p {
    margin: 5px 0 0;
    font-size: 14px;
}


.header .add-asset-btn {
    background-color: #2f276f ;
    color: white;
    padding: 10px 20px;
    font-size: 14px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: background-color 0.3s ease;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
}

.header .add-asset-btn:hover {
    background-color: #291e6c;
}

        .menu {
            cursor: pointer;
            font-size: 24px;
            padding: 10px;
            background-color: #2f276f ;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .menu:hover {
            background-color: #291e6c;
        }

        .menu-dropdown {
            display: none; /* Hidden by default */
            position: absolute;
            top: 60px; /* Below the menu button */
            right: 20px;
            background-color: white;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            overflow: hidden;
            z-index: 1000;
        }

        .menu-dropdown a,
        .menu-dropdown button {
            display: block;
            text-decoration: none;
            color: #2f276f ;
            padding: 10px 20px;
            border: none;
            background: none;
            text-align: left;
            width: 100%;
            cursor: pointer;
        }

        .menu-dropdown a:hover,
        .menu-dropdown button:hover {
            background-color: #f4f4f9;
        }r: #f4f4f9;
        }






/* Button styling */
a.button, button {
    display: inline-block;
    padding: 10px 20px;
    background-color: #2f276f ;
    color: white;
    text-align: center;
    text-decoration: none;
    border-radius: 5px;
    font-size: 14px; /* Ensure consistent font size */
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.1s;
    margin-bottom: 10px;
}

a.button:hover, button:hover {
    background-color: #32383e;
    transform: translateY(-2px);
}






/* action button drop down actions */


.dropdown-button {
    background-color: #2f276f ; /* Match table header blue */
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    border: none;
    transition: background-color 0.3s ease;
    font-size: 14px;
    position: relative;
}

.dropdown-button:hover {
    background-color: #2f276f; /* Slightly darker blue for hover */
}




/* Dropdown container styling */
.dropdown {
    position: relative;
    display: inline-block;
}

/* Dropdown content */
.dropdown-content {
    display: none;
    position: absolute;
    background-color: #ffffff;
    box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.15);
    min-width: 180px;
    border-radius: 8px;
    overflow: hidden;
    z-index: 1000;
    right: 0;
}

/* Show dropdown on click */
.dropdown.active .dropdown-content {
    display: block;
}

/* Dropdown content styling */
.dropdown-content a, .dropdown-content button {
    padding: 12px 16px;
    background-color: white;
    color: #343a40;
    text-align: left;
    text-decoration: none;
    border-bottom: 1px solid #e9ecef;
    transition: background-color 0.3s ease;
    font-size: 14px; /* Ensure consistent font size */
    display: block;
    width: 100%;
}

.dropdown-content a:hover, .dropdown-content button:hover {
    background-color: #f1f1f1;
}


/* action button drop down actions ends here */

/* Modal styling */
.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
    background-color: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    max-width: 1000px;
    margin: 80px auto;
    position: relative;
    font-family: 'Roboto', sans-serif; /* Ensure consistent font family */
    font-size: 14px; /* Ensure consistent font size */
}

/* Print button */
.print-button {
    background-color: #28a745;
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    margin-top: 10px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s;
}

.print-button:hover {
    background-color: #218838;
}

/* Details section styling for 4 columns */
.details-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    font-size: 14px; /* Ensure consistent font size */
    font-family: 'Roboto', sans-serif; /* Ensure consistent font family */
    margin-bottom: 20px;
}

.label {
    font-weight: bold;
    text-align: right;
    padding-right: 10px;
}

.value {
    background-color: #f8f9fa;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #dee2e6;
}

/* Modal table styles */
.modal-table th, .modal-table td {
    padding: 10px;
    text-align: left;
    font-size: 14px; /* Ensure consistent font size */
    font-family: 'Roboto', sans-serif; /* Ensure consistent font family */
}

.modal-table th {
    background-color: #6c757d;
    color: white;
    font-weight: 600;
}

.modal-table td {
    background-color: white;
    border-bottom: 1px solid #dee2e6;
}

/* Print styles */
@media print {
    .modal-content {
        box-shadow: none;
        margin: 0;
        width: 100%;
    }

    .print-button {
        display: none;
    }
}



/* Search Bar */
#search-bar {
    margin-top: 10px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
    width: 300px;
}

/* Pagination Styling */
.pagination {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    gap: 10px;
}

.pagination button {
    background-color: #2f276f ;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s ease;
}

.pagination button.active {
    background-color: #291e6c;
}

.pagination button:hover {
    background-color: #291e6c;
}




  .menu-button {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
            background-color: #2f276f ; /* Dark gray */
            color: white;
            border-radius: 50%; /* Circle shape */
            border: none;
            cursor: pointer;
            font-size: 24px;
            position: fixed; /* Fix to the screen */
            top: 20px; /* Adjust distance from the top */
            right: 20px; /* Adjust distance from the right */
            z-index: 1000; /* Ensure it appears above other elements */
            transition: background-color 0.3s ease;
        }

        .menu-button:hover {
            background-color: #32383e; /* Darker gray on hover */
        }
		
		
.button-container {
    display: flex;
    justify-content: flex-end; /* Push button to the right */
    align-items: center; /* Align button vertically */
    margin-right: 10px; /* Add a small gap from the right */
    margin-top: 10px; /* Optional for spacing above */
}
		
		.add-asset-btn {
            background-color: #2F276F;
            color: white;
            padding: 10px 20px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            
			justify-content: center
            gap: 8px;
            transition: background-color 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

       .add-asset-btn:hover {
            background-color: #291e6c;
        }


.main-content {
            padding: 20px;
        }

        .main-content h2 {
            font-size: 20px;
            color: #2f276f ;
            margin-bottom: 5px;
        }

        .main-content p {
            font-size: 14px;
            color: #666;
        }


/* New parent container for Assets header */
.assets-header {
    display: flex; /* Use flexbox for horizontal alignment */
    justify-content: space-between; /* Push items to far ends */
    align-items: center; /* Vertically align items */
    margin-bottom: 20px; /* Add spacing below the header */
}

/* Heading styling */
.assets-header h2 {
    margin: 0; /* Remove default margin for better alignment */
    font-size: 18px; /* Adjust as needed */
    color: #2f276f ; /* Optional: match the button color */
}

/* Button container styling */
.assets-header .button-container {
    margin-right: 10px; /* Add small gap from the edge if needed */
}




/* General container styles */
.content, .asset-table-wrapper {
    width: 100%;
    margin: 0;
    padding: 0 20px;
    box-sizing: border-box;
}

/* Table Wrapper */
.asset-table-wrapper {
    width: 100%;
    margin: 0 auto;
    overflow-x: auto; /* Enable horizontal scrolling for overflow */
}

/* Table */
.asset-table {
    width: 100%;
    table-layout: auto; /* Columns adjust based on content */
    border-collapse: collapse;
    margin: 0;
}

/* Reset default table styles */
.asset-table th, .asset-table td {
    padding: 10px;
    text-align: left;
    border: 1px solid #ddd;
}

.asset-table th {
    background-color: #2f276f;
    color: white;
}

.asset-table td {
    background-color: #fff;
}

/* Add responsive behavior */
@media (max-width: 768px) {
    .asset-table th, .asset-table td {
        font-size: 12px;
        padding: 8px;
    }
}



.asset-table tr:hover td {
    background-color: #f1f1f1;
}

.asset-table td:last-child {
    text-align: center;
}

.download-excel-btn {
            background-color: #2f276f; /* Blue color */
            color: white;
            padding: 10px 20px;
            font-size: 14px; /* Consistent font size */
            border: none;
            border-radius: 8px; /* Rounded edges */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s;
            margin-bottom: 10px; /* Optional: Adjust spacing below the button */
        }

        .download-excel-btn:hover {
            background-color: #291e6c; /* Slightly darker blue on hover */
            transform: translateY(-2px); /* Small lift effect on hover */
        }


    </style>
</head>
<body>
  

	
	    <div class="header">
        <h1>IT Asset Tracker</h1>
		
        <div class="menu" onclick="headertoggleMenu()">☰</div>
        <div class="menu-dropdown" id="menuDropdown">
		
		   <a href="{{ url_for('it_dashboard', source=source) }}">Dashboard</a>
           
            <a href="{{ url_for('it_assets_index', source=source) }}">Manage IT Assets</a>
			{% if 'view_service_details' in permissions %}
			<a href="{{ url_for('service_details_index', source=source)}}">View Service Details</a>
			{% endif %} 
            
            
            
            {% if 'raise_ticket' in permissions %}
			<a href="{{ url_for('raised_ticket_details_index', source=source)}}">Raised Tickets</a>
            {% endif %}

			
        </div>
    </div>
	
	
	
	
	<div class="main-content">
		<div class="assets-header">
			<h1>Assets</h1>
			<div class="button-container">
				<button class="add-asset-btn" onclick="location.href='{{ url_for('it_asset_form', source=source) }}';">
					<span> + </span> Add Asset
				</button>

				
				
			</div>
		</div>


	
	<button onclick="exportTableToExcel()" class="download-excel-btn">Download Excel</button>



    <input type="text" id="search-bar" placeholder="Search assets..." onkeyup="handleSearch()"/><br>

    <table class="asset-table">
        <thead>
            <tr>
                <th>Created by</th>
                <th>Asset Category</th>
                <th>Asset ID</th>
                <th>Product Name</th>
                <th>Serial No</th>
                <th>Make</th>
                <th>Model</th>
                 <th>User Status</th>
                <th>Remarks</th>
                <th>Condition</th>
                <th>Actions</th>
				
            </tr>
        </thead>
        <tbody id="asset-table-body">
            <!-- Table rows will be dynamically inserted here -->
        </tbody>
    </table>

    <div class="pagination" id="pagination"></div>
	


    <!-- Modal for viewing details -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('myModal').style.display='none'">&times;</span>
            
            <!-- Container to show asset details -->
<!-- First two columns: Field names (left side) and values (right side) -->
<div class="details-container">
    <!-- First Column (Left) -->
	
	<div class="label">Created by:</div>
    <div class="value" id="created_by"></div>

    <div class="label">Created at:</div>
    <div class="value" id="created_at"></div>
	
	
    <div class="label">Asset ID:</div>
    <div class="value" id="asset_id"></div>

    <div class="label">Product Name:</div>
    <div class="value" id="product_name"></div>

    <div class="label">Serial No:</div>
    <div class="value" id="serial_no"></div>

    <div class="label">Make:</div>
    <div class="value" id="make"></div>

    <div class="label">Model:</div>
    <div class="value" id="model"></div>

    <div class="label">Part No:</div>
    <div class="value" id="part_no"></div>

    <div class="label">Value:</div>
    <div class="value" id="value"></div>

    <div class="label">Purchase Date:</div>
    <div class="value" id="purchase_date"></div>

    <div class="label">Vendor Name:</div>
    <div class="value" id="vendor_name"></div>


    <div class="label">Company Name:</div>
    <div class="value" id="company_name"></div>

    <!-- Second Column (Right) -->
    <div class="label">Asset Type:</div>
    <div class="value" id="asset_type"></div>

    <div class="label">Warranty Checked:</div>
    <div class="value" id="warranty_checked"></div>

    <div class="label">Warranty:</div>
    <div class="value" id="warranty"></div>

    <div class="label">Extended Warranty:</div>
    <div class="value" id="extended_warranty"></div>

    <div class="label">Insurance:</div>
    <div class="value" id="insurance"></div>

    <div class="label">Modified By:</div>
    <div class="value" id="modified_by"></div>

    <div class="label">Modified At:</div>
    <div class="value" id="modified_at"></div>

    <div class="label">Description:</div>
    <div class="value" id="description"></div>

    <div class="label">Remarks:</div>
    <div class="value" id="remarks"></div>

    <div class="label">Product Age:</div>
    <div class="value" id="product_age"></div>

    <div class="label">Product Condition:</div>
    <div class="value" id="product_condition"></div>

    <div class="label">Asset Category:</div>
    <div class="value" id="asset_category"></div>
	
	<div id="barcode"></div>
      
</div>


            <!-- Service Details Table -->
            <h3>Service Details</h3>
            <table id="service-details-table" class="modal-table asset-table">
                <thead>
                    <tr>
                        <th>Service ID</th>
                        <th>Service Type</th>
                        <th>Ticket ID</th>
                        <th>Work Done</th>
                        <th>Next Service Date</th>
                        <th>Charge</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows dynamically inserted here -->
                </tbody>
            </table>

            <!-- Raised Tickets Table -->
            <h3>Raised Tickets</h3>
            <table id="raised-tickets-table" class="modal-table asset-table">
                <thead>
                    <tr>
                        <th>Ticket ID</th>
                        <th>Problem Description</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows dynamically inserted here -->
                </tbody>
            </table>

            <!-- Extended Warranty Table -->
            <h3>Extended Warranty Info</h3>
            <table id="extended-warranty-table" class="modal-table asset-table">
                <thead>
                    <tr>
                        <th>Warranty Asset ID</th>
                        <th>Purchase Date</th>
                        <th>Extended Warranty</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows dynamically inserted here -->
                </tbody>
            </table>

            <button class="print-button" onclick="printDetails()">Print Details</button>
        </div>
    </div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
	
<script>
    const permissions = {{ permissions | tojson }};
</script>



<script>
        function headertoggleMenu() {
            const menu = document.getElementById('menuDropdown');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        // Close the dropdown if clicked outside
        document.addEventListener('click', function (event) {
            const dropdown = document.getElementById('menuDropdown');
            const menuButton = document.querySelector('.menu');

            if (!dropdown.contains(event.target) && !menuButton.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });
    </script>







    <script>
	
	
		function exportTableToExcel() {
    const tableData = [];
    const tableRows = document.querySelectorAll('#asset-table-body tr');

    // Add header row (without 'Actions' column)
    const headers = ['Created by', 'Asset Category', 'Asset ID', 'Product Name', 'Serial No', 'Make', 'Model', 'Remarks', 'Condition'];
    tableData.push(headers);

    // Add each row data
    tableRows.forEach(row => {
        const rowData = [];
        const cells = row.querySelectorAll('td');

        // Push each cell except for the last one (Actions column)
        for (let i = 0; i < cells.length - 1; i++) {
            rowData.push(cells[i].innerText);
        }

        tableData.push(rowData);
    });

    // Create a new workbook and add the data
    const ws = XLSX.utils.aoa_to_sheet(tableData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Assets');

    // Save the Excel file
    XLSX.writeFile(wb, 'assets_data.xlsx');
}

	
	
        let allAssets = [];
        let filteredAssets = [];
        const perPage = 5;
        let currentPage = 1;
        let source;
		let status;

        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
		
		


		
		
		function fetchAssets(search = '') {
			source = getUrlParameter('source');
			console.log('source fetching', source);
			
			// Make API request to search assets with the provided search term
			fetch(`/api/search-assets?source=${source}&search=${encodeURIComponent(search)}`)
				.then(response => response.json())
				.then(data => {
					// Log the assets data to ensure the 'user_status' field is included
					console.log('Assets data:', data.assets);
					allAssets = data.assets;

					// If search term exists, filter assets based on all fields including 'user_status'
					if (search) {
						filteredAssets = allAssets.filter(asset => {
							return Object.values(asset).some(value => {
								// Convert each value to a string and check if it includes the search term
								const valueStr = String(value).toLowerCase();
								const matches = valueStr.includes(search.toLowerCase());

								// Log each match for debugging
								if (matches) {
									console.log(`Match found in field: ${valueStr}`);
								}

								return matches;
							});
						});
					} else {
						// If there's no search term, show all assets
						filteredAssets = allAssets;
					}

					// Display the filtered assets
					displayAssets();

					// Generate pagination (assuming you have a perPage variable defined)
					generatePagination(Math.ceil(filteredAssets.length / perPage));
				})
				.catch(error => {
					console.error('Error fetching assets:', error);
				});
		}

				
		
		
		
		
		
		
		
		
		
		
		
		

        function displayAssets() {
				const tbody = document.getElementById('asset-table-body');
				tbody.innerHTML = '';

				const start = (currentPage - 1) * perPage;
				const end = start + perPage;

				const assetsToDisplay = filteredAssets.slice(start, end);

				assetsToDisplay.forEach(asset => {
					console.log('Asset:', asset);

					if (!asset.asset_id) {
						console.error('Error: asset_id is undefined for asset:', asset);
						return;
					}


					const status = userStatus[asset.asset_id] || 'No User Assigned';
					
					let actions = '';
					
					if (permissions.includes("view")) {
						actions += `<a href="#" onclick="showDetails('${asset.asset_id}')">View Details</a>`;
					}
					if (permissions.includes("edit")) {
						actions += `<a href="/it_asset_form?asset_id=${asset.asset_id}&source=${source}" class="edit">Edit</a>`;
					}
					if (permissions.includes("add_user")) {
						actions += `<a href="/asset_users?asset_id=${asset.asset_id}&source=${source}" class="user">Add User</a>`;
					}
					if (permissions.includes("extended_warranty")) {
						actions += `<a href="/view_all_extended_warranties?asset_id=${asset.asset_id}&source=${source}" class="warranty">Extended Warranty</a>`;
					}
					if (permissions.includes("raise_ticket")) {
						actions += `<a href="/raise_ticket?asset_id=${asset.asset_id}&product_name=${asset.product_name}&serial_no=${asset.serial_no}&asset_category=${asset.asset_category}&source=${source}" class="ticket">Raise Ticket</a>`;
					}
					if (permissions.includes("insurance")) {
						actions += `<a href="/insurance_details?asset_id=${asset.asset_id}&source=${source}" class="insurance">Insurance Details</a>`;
					}
					if (permissions.includes("delete")) {
						actions += `<button class="delete" onclick="deleteItem('${asset.asset_id}')">Delete</button>`;
					}

					const row = `
						<tr>
							<td>${asset.created_by} at ${asset.created_at}</td>
							<td>${asset.asset_category}</td>
							<td>${asset.asset_id}</td>
							<td>${asset.product_name}</td>
							<td>${asset.serial_no}</td>
							<td>${asset.make}</td>
							<td>${asset.model}</td>
							<td>${status}</td>
							<td>${asset.remarks}</td>
							<td>${asset.product_condition}</td>
							<td>
								<div class="dropdown" onclick="toggleDropdown(this)">
									<button class="dropdown-button">Actions</button>
									<div class="dropdown-content">
										${actions}
									</div>
								</div>
							</td>
						</tr>
					`;
					tbody.insertAdjacentHTML('beforeend', row);
				});
		}


        function generatePagination(totalPages) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            for (let page = 1; page <= totalPages; page++) {
                const pageButton = document.createElement('button');
                pageButton.innerText = page;
                pageButton.className = page === currentPage ? 'active' : '';
                pageButton.onclick = () => {
                    currentPage = page;
                    displayAssets();
                };
                pagination.appendChild(pageButton);
            }
        }

        function handleSearch() {
            const searchTerm = document.getElementById('search-bar').value.toLowerCase();
            filteredAssets = allAssets.filter(asset => {
                return Object.values(asset).some(value =>
                    String(value).toLowerCase().includes(searchTerm)
                );
            });
            currentPage = 1;
            displayAssets();
            generatePagination(Math.ceil(filteredAssets.length / perPage));
        }


		
		function toggleDropdown(dropdownElement) {
				const dropdowns = document.querySelectorAll('.dropdown');
				dropdowns.forEach(dd => {
					if (dd !== dropdownElement) {
						dd.classList.remove('active');
					}
				});

				dropdownElement.classList.toggle('active');
			}

			// Close dropdown when clicking outside
			document.addEventListener('click', function(event) {
				const dropdowns = document.querySelectorAll('.dropdown');
				dropdowns.forEach(dropdown => {
					if (!dropdown.contains(event.target)) {
						dropdown.classList.remove('active');
					}
				});
			});
			
			



		function showDetails(asset_id) {
    fetch(`/view_it_asset_details/${asset_id}`)
        .then(response => response.json())
        .then(data => {
            // Populate the modal with the data
            document.getElementById('created_by').innerText = data.asset_details.created_by;
            document.getElementById('created_at').innerText = data.asset_details.created_at;
            document.getElementById('asset_id').innerText = data.asset_details.asset_id;
            document.getElementById('product_name').innerText = data.asset_details.product_name;
            document.getElementById('serial_no').innerText = data.asset_details.serial_no;
            document.getElementById('make').innerText = data.asset_details.make;
            document.getElementById('model').innerText = data.asset_details.model;
            document.getElementById('part_no').innerText = data.asset_details.part_no;
            document.getElementById('value').innerText = data.asset_details.value;
            document.getElementById('purchase_date').innerText = data.asset_details.purchase_date;
            document.getElementById('vendor_name').innerText = data.asset_details.vendor_name;
            document.getElementById('company_name').innerText = data.asset_details.company_name;
            document.getElementById('asset_type').innerText = data.asset_details.asset_type;
            document.getElementById('warranty_checked').innerText = data.asset_details.warranty_checked;
            document.getElementById('warranty').innerText = data.asset_details.warranty;
            document.getElementById('extended_warranty').innerText = data.asset_details.extended_warranty;
            document.getElementById('insurance').innerText = data.asset_details.insurance;
            document.getElementById('modified_by').innerText = data.asset_details.modified_by;
            document.getElementById('modified_at').innerText = data.asset_details.modified_at;
            document.getElementById('description').innerText = data.asset_details.description;
            document.getElementById('remarks').innerText = data.asset_details.remarks;
            document.getElementById('product_age').innerText = data.asset_details.product_age;
            document.getElementById('product_condition').innerText = data.asset_details.product_condition;
            document.getElementById('asset_category').innerText = data.asset_details.asset_category;

            // Populate tables with details
            populateTable('service-details-table', data.service_details, ['service_id', 'service_type', 'ticket_id', 'work_done', 'next_service_date', 'charge']);
            populateTable('raised-tickets-table', data.raised_tickets, ['ticket_id', 'problem_description', 'status']);
            populateTable('extended-warranty-table', data.extended_warranty_info, ['warranty_asset_id', 'purchase_date', 'extended_warranty', 'value']);

            // Generate barcode for asset_id
            const canvas = document.createElement('canvas');
            JsBarcode(canvas, data.asset_details.asset_id, {
                format: "CODE128",
                width: 2,
                height: 40,
                displayValue: true
            });

            // Append barcode to the modal
            const barcodeContainer = document.getElementById('barcode');
            barcodeContainer.innerHTML = ''; // Clear existing barcode
            barcodeContainer.appendChild(canvas);

            // Show the modal
            document.getElementById('myModal').style.display = 'block';
        })
        .catch(error => console.error('Error:', error));
}

		
		


        function populateTable(tableId, data, columns) {
            const tbody = document.getElementById(tableId).querySelector('tbody');
            tbody.innerHTML = '';
            data.forEach(item => {
                const row = document.createElement('tr');
                columns.forEach(col => {
                    const cell = document.createElement('td');
                    cell.innerText = item[col];
                    row.appendChild(cell);
                });
                tbody.appendChild(row);
            });
        }

        function deleteItem(asset_id) {
            if (confirm("Are you sure you want to delete this asset?")) {
                fetch(`/delete/it_asset/${asset_id}`, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            fetchAssets();
                        } else {
                            alert(`Error deleting asset: ${data.message}`);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
        }

        function printDetails() {
            const myModal = document.getElementById('myModal').innerHTML;
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>Print</title>');
            printWindow.document.write('<style> body { font-family: Arial, sans-serif; } table { width: 100%; margin-bottom: 20px; border-collapse: collapse; } th, td { padding: 8px; border: 1px solid #ddd; } th { background-color: #6c757d; color: white; } </style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write(myModal);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
            printWindow.close();
        }

        window.onload = function() {
            fetchAssets();
        };
    </script>
<script>
    // Pass user_status from the backend to the frontend
    const userStatus = {{ user_status | tojson }};
	 console.log('User Status:', userStatus);  
</script>

<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>


</body>
</html>
